generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id              Int         @id @default(autoincrement())
  email           String      @unique
  cpf             String      @unique
  criadoEm        DateTime    @default(now())
  data_nascimento DateTime
  nome_completo   String
  senha_hash      String
  role            Role        @default(USER)
  sexo            String?
  cidade          String?
  estado          String?
  telefone        String?
  inscricoes      Inscricao[]
}

model Evento {
  id          Int           @id @default(autoincrement())
  titulo      String
  dataEvento  DateTime
  local       String
  descricao   String?
  imagem_url  String?
  organizador String?
  banner_url  String?
  meta        Json?
  categorias  Categoria[]
  opcoes      EventoOpcao[]
  inscricoes  Inscricao[]
}

model Categoria {
  id       Int    @id @default(autoincrement())
  nome     String
  eventoId Int
  evento   Evento @relation(fields: [eventoId], references: [id])
}

model Inscricao {
  status    String     @default("PENDENTE")
  usuarioId Int
  eventoId  Int
  id        Int        @id @default(autoincrement())
  evento    Evento     @relation(fields: [eventoId], references: [id])
  usuario   Usuario    @relation(fields: [usuarioId], references: [id])
  pagamento Pagamento?

  @@unique([usuarioId, eventoId])
}

model Pagamento {
  id              Int          @id @default(autoincrement())
  valor           Float
  status          String       @default("PENDENTE")
  metodo          String
  criadoEm        DateTime     @default(now())
  inscricaoId     Int          @unique
  opcaoId         Int?
  taxa_percentual Float?
  valor_base      Float?
  valor_taxa      Float?
  inscricao       Inscricao    @relation(fields: [inscricaoId], references: [id])
  opcao           EventoOpcao? @relation(fields: [opcaoId], references: [id])
}

model EventoOpcao {
  id              Int         @id @default(autoincrement())
  titulo          String
  tipo            TipoOpcao
  distancia_km    Float
  preco           Float
  taxa_percentual Float
  eventoId        Int
  evento          Evento      @relation(fields: [eventoId], references: [id])
  pagamentos      Pagamento[]
}

enum TipoOpcao {
  CORRIDA
  CAMINHADA
}

enum Role {
  USER
  ADMIN
}
